(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/goods_combination_details/index"],{"16b2":function(t,e,i){"use strict";i.r(e);var o=i("1aec"),n=i.n(o);for(var r in o)"default"!==r&&function(t){i.d(e,t,(function(){return o[t]}))}(r);e["default"]=n.a},"1aec":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i("26cb"),n=i("a368"),r=i("64d0"),s=i("768b"),u=(i("18f5"),i("816a")),a=h(i("9ad2")),c=i("2eb8"),l=i("168b");function h(t){return t&&t.__esModule?t:{default:t}}var d=getApp(),p=function(){i.e("components/Authorize").then(function(){return resolve(i("cacf"))}.bind(null,i)).catch(i.oe)},f=function(){i.e("components/productConSwiper/index").then(function(){return resolve(i("d7b4"))}.bind(null,i)).catch(i.oe)},m=function(){i.e("components/productWindow/index").then(function(){return resolve(i("f9f0"))}.bind(null,i)).catch(i.oe)},g=function(){i.e("components/userEvaluation/index").then(function(){return resolve(i("9343"))}.bind(null,i)).catch(i.oe)},$=function(){i.e("components/countDown/index").then(function(){return resolve(i("bda5"))}.bind(null,i)).catch(i.oe)},b=function(){Promise.all([i.e("common/vendor"),i.e("components/kefuIcon/index")]).then(function(){return resolve(i("107b"))}.bind(null,i)).catch(i.oe)},v=function(){Promise.all([i.e("common/vendor"),i.e("components/jyf-parser/jyf-parser")]).then(function(){return resolve(i("7772"))}.bind(null,i)).catch(i.oe)},_=function(){i.e("components/cusPreviewImg/index").then(function(){return resolve(i("d13e"))}.bind(null,i)).catch(i.oe)},S=function(){i.e("components/menuIcon").then(function(){return resolve(i("bf02"))}.bind(null,i)).catch(i.oe)},I=function(){i.e("components/homeList/index").then(function(){return resolve(i("14d2"))}.bind(null,i)).catch(i.oe)},A=t.getSystemInfoSync().statusBarHeight+"px",k={components:{productConSwiper:f,kefuIcon:b,authorize:p,"product-window":m,userEvaluation:g,countDown:$,cusPreviewImg:_,parser:v,menuIcon:S,homeList:I},computed:(0,o.mapGetters)({isLogin:"isLogin",userData:"userInfo"}),mixins:[a.default,c.sharePoster],data:function(){return{imgHost:l.HTTP_REQUEST_URL,dataShow:0,navH:"",id:0,userInfo:{},itemNew:[],indicatorDots:!1,circular:!0,autoplay:!0,interval:3e3,duration:500,attribute:{cartAttr:!1,productAttr:[],productSelect:{}},productValue:[],isOpen:!1,attr:this.$t("请选择"),attrValue:"",AllIndex:2,maxAllIndex:0,replyChance:"",limitNum:1,timeer:null,iSplus:!1,navList:[this.$t("商品"),this.$t("评价"),this.$t("详情")],opacity:0,scrollY:0,topArr:[],toView:"",height:0,heightArr:[],lock:!1,scrollTop:0,storeInfo:{},pink_ok_sum:0,pink:[],replyCount:0,reply:[],imgUrls:[],sharePacket:"",tagStyle:{img:"width:100%;display:block;",table:"width:100%",video:"width:100%"},posters:!1,weixinStatus:!1,posterImageStatus:!1,canvasStatus:!1,storeImage:"",PromotionCode:"",posterImage:"",posterbackgd:"/static/images/posterbackgd.png",navActive:0,actionSheetHidden:!1,attrTxt:"",cart_num:"",isAuto:!1,isShowAuth:!1,AllIndexDefault:0,homeTop:20,returnShow:!0,H5ShareBox:!1,routineContact:0,skuArr:[],selectSku:{},showMenuIcon:!1,currentPage:!1,sysHeight:A}},watch:{isLogin:{handler:function(t,e){t&&this.combinationDetail()},deep:!0}},onLoad:function(e){var i=this,o=this,r=getCurrentPages();if(o.returnShow=1!==r.length,this.$nextTick((function(){var e=t.getMenuButtonBoundingClientRect(),o=t.createSelectorQuery().in(i);o.select("#home").boundingClientRect((function(t){i.homeTop=2*e.top+e.height-t.height})).exec()})),this.navH=d.globalData.navHeight,t.getSystemInfo({success:function(t){o.height=t.windowHeight}}),e.scene){var s=this.$util.getUrlParams(decodeURIComponent(e.scene));s.id&&(e.id=s.id),s.pid&&(d.globalData.spid=s.pid)}if(!e.id&&!e.scene)return this.$util.Tips({title:this.$t("缺少参数无法查看商品")},{tab:3,url:1});if(e.spid&&(d.globalData.spid=e.spid),e.hasOwnProperty("id"))this.id=e.id,this.isLogin?this.combinationDetail():(this.$Cache.set("login_back_url","/pages/activity/goods_combination_details/index?id=".concat(e.id)),(0,n.toLogin)());else try{var u=t.getStorageSync("comGoodsId");""!=u&&(this.id=u,this.combinationDetail())}catch(a){t.showToast({title:this.$t("参数错误"),icon:"none",duration:1e3,mask:!0})}},onNavigationBarButtonTap:function(t){this.currentPage=!this.currentPage},methods:{moreNav:function(){this.currentPage=!this.currentPage},qrR:function(t){},showAll:function(){this.AllIndexDefault=this.AllIndex,this.AllIndex=this.pink.length},hideAll:function(){this.AllIndex=this.AllIndexDefault},authColse:function(t){this.isShowAuth=t},iptCartNum:function(t){this.$set(this.attribute.productSelect,"cart_num",t),this.$set(this,"cart_num",t)},returns:function(){return t.navigateBack({delta:1})},combinationDetail:function(){var e=this,i=this,o=i.id;(0,r.getCombinationDetail)(o).then((function(o){for(var n in i.dataShow=1,t.setNavigationBarTitle({title:o.data.storeInfo.title.substring(0,16)}),i.imgUrls=o.data.storeInfo.images,i.storeInfo=o.data.storeInfo,i.storeInfo.description=i.storeInfo.description.replace(/<img/gi,'<img style="max-width:100%;height:auto;float:left;display:block" '),i.attribute.productSelect.num=o.data.storeInfo.num,i.pink=o.data.pink,i.pindAll=o.data.pindAll,i.reply=o.data.reply?[o.data.reply]:[],i.replyCount=o.data.replyCount,i.itemNew=o.data.pink_ok_list,i.pink_ok_sum=o.data.pink_ok_sum,i.replyChance=o.data.replyChance,i.attribute.productAttr=o.data.productAttr,i.productValue=o.data.productValue,e.storeInfo.wechat_code&&i.$set(i,"PromotionCode",e.storeInfo.wechat_code),i.routineContact=Number(o.data.routine_contact_type),o.data.productValue){var r=o.data.productValue[n];i.skuArr.push(r)}i.$set(i,"selectSku",i.skuArr[0]);var s=[i.$t("商品"),i.$t("详情")];o.data.replyCount&&s.splice(1,0,i.$t("评价")),i.$set(i,"navList",s),i.storeImage=i.storeInfo.image,i.downloadFilestoreImage(),i.DefaultSelect(),setTimeout((function(){i.infoScroll()}),500)})).catch((function(t){i.$util.Tips({title:t},{tab:3})}))},downloadFileAppCode:function(){var e=this;t.downloadFile({url:e.setDomain(e.PromotionCode),success:function(t){e.PromotionCode=t.tempFilePath},fail:function(){return e.$util.Tips({title:""})}})},DefaultSelect:function(){var t=this,e=t.attribute.productAttr,i=[];for(var o in this.productValue)if(this.productValue[o].quota>0){i=this.attribute.productAttr.length?o.split(","):[];break}for(var n=0;n<e.length;n++)this.$set(e[n],"index",i[n]);var r=t.productValue[i.join(",")];r&&e.length?(t.$set(t.attribute.productSelect,"store_name",t.storeInfo.title),t.$set(t.attribute.productSelect,"image",r.image),t.$set(t.attribute.productSelect,"price",r.price),t.$set(t.attribute.productSelect,"stock",r.stock),t.$set(t.attribute.productSelect,"unique",r.unique),t.$set(t.attribute.productSelect,"quota",r.quota),t.$set(t.attribute.productSelect,"quota_show",r.quota_show),t.$set(t.attribute.productSelect,"product_stock",r.product_stock),t.$set(t.attribute.productSelect,"cart_num",1),t.$set(t,"attrValue",i.join(",")),t.attrValue=i.join(",")):!r&&e.length?(t.$set(t.attribute.productSelect,"store_name",t.storeInfo.title),t.$set(t.attribute.productSelect,"image",t.storeInfo.image),t.$set(t.attribute.productSelect,"price",t.storeInfo.price),t.$set(t.attribute.productSelect,"quota",0),t.$set(t.attribute.productSelect,"quota_show",0),t.$set(t.attribute.productSelect,"product_stock",0),t.$set(t.attribute.productSelect,"stock",0),t.$set(t.attribute.productSelect,"unique",""),t.$set(t.attribute.productSelect,"cart_num",0),t.$set(t,"attrValue",""),t.$set(t,"attrTxt",this.$t("请选择"))):r||e.length||(t.$set(t.attribute.productSelect,"store_name",t.storeInfo.title),t.$set(t.attribute.productSelect,"image",t.storeInfo.image),t.$set(t.attribute.productSelect,"price",t.storeInfo.price),t.$set(t.attribute.productSelect,"stock",t.storeInfo.stock),t.$set(t.attribute.productSelect,"quota",0),t.$set(t.attribute.productSelect,"product_stock",0),t.$set(t.attribute.productSelect,"unique",t.storeInfo.unique||""),t.$set(t.attribute.productSelect,"cart_num",1),t.$set(t,"attrValue",""),t.$set(t,"attrTxt",this.$t("请选择")))},infoScroll:function(){for(var e=this,i=[],o=[],n=0;n<e.navList.length;n++){var r=t.createSelectorQuery().in(this),s="#past"+n;this.replyCount||1!=n||(s="#past2"),r.select(s).boundingClientRect(),r.exec((function(t){var n=t[0].top,r=t[0].height;i.push(n),o.push(r),e.topArr=i,e.heightArr=o}))}},onLoadFun:function(t){this.userInfo=t,d.globalData.openPages="/pages/activity/goods_combination_details/index?id="+this.id+"&spid="+t.uid,this.combinationDetail()},selecAttr:function(){this.attribute.cartAttr=!0},onMyEvent:function(){this.$set(this.attribute,"cartAttr",!1),this.$set(this,"isOpen",!1)},ChangeCartNum:function(t){var e=this.productValue[this.attrValue];if(this.cart_num&&(e.cart_num=this.cart_num,this.attribute.productSelect.cart_num=this.cart_num),void 0!==e||this.attribute.productAttr.length||(e=this.attribute.productSelect),void 0!==e){e.stock,e.quota_show;var i=e.quota||0,o=e.product_stock||0,n=this.attribute.productSelect,r=this.storeInfo.num||0;if(void 0==e.cart_num&&(e.cart_num=1),t){n.cart_num++;var s=[];s.push(r),s.push(i),s.push(o);var u=Math.min.apply(null,s);n.cart_num>=u&&(this.$set(this.attribute.productSelect,"cart_num",u||1),this.$set(this,"cart_num",u||1)),this.$set(this,"cart_num",n.cart_num),this.$set(this.attribute.productSelect,"cart_num",n.cart_num)}else n.cart_num--,n.cart_num<1&&(this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this,"cart_num",1)),this.$set(this,"cart_num",n.cart_num),this.$set(this.attribute.productSelect,"cart_num",n.cart_num)}},attrVal:function(t){this.attribute.productAttr[t.indexw].index=this.attribute.productAttr[t.indexw].attr_values[t.indexn]},ChangeAttr:function(t){this.$set(this,"cart_num",1);var e=this.productValue[t];this.$set(this,"selectSku",e),e?(this.$set(this.attribute.productSelect,"image",e.image),this.$set(this.attribute.productSelect,"price",e.price),this.$set(this.attribute.productSelect,"stock",e.stock),this.$set(this.attribute.productSelect,"unique",e.unique),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this.attribute.productSelect,"quota",e.quota),this.$set(this.attribute.productSelect,"quota_show",e.quota_show),this.$set(this,"attrValue",t),this.attrTxt=this.$t("已选择")):(this.$set(this.attribute.productSelect,"image",this.storeInfo.image),this.$set(this.attribute.productSelect,"price",this.storeInfo.price),this.$set(this.attribute.productSelect,"stock",0),this.$set(this.attribute.productSelect,"unique",""),this.$set(this.attribute.productSelect,"cart_num",0),this.$set(this.attribute.productSelect,"quota",0),this.$set(this.attribute.productSelect,"quota_show",0),this.$set(this,"attrValue",""),this.attrTxt=this.$t("已选择"))},goProduct:function(){t.navigateTo({url:"/pages/goods_details/index?id="+this.storeInfo.product_id})},goCat:function(){var e=this;this.currentPage=!1;var i=this.productValue[this.attrValue];if(this.isOpen?this.attribute.cartAttr=!0:this.attribute.cartAttr=!this.attribute.cartAttr,!0===this.attribute.cartAttr&&0==this.isOpen)return this.isOpen=!0;if(this.attribute.productAttr.length&&void 0===i&&1==this.isOpen)return e.$util.Tips({title:this.$t("请选择")});var o={productId:e.storeInfo.product_id,secKillId:0,bargainId:0,combinationId:e.id,cartNum:e.cart_num,uniqueId:void 0!==i?i.unique:"",is_new:1};(0,s.postCartAdd)(o).then((function(i){e.isOpen=!1,t.navigateTo({url:"/pages/goods/order_confirm/index?new=1&cartId="+i.data.cartId})})).catch((function(e){t.showToast({title:e,icon:"none"})}))},setCollect:function(){var t=this;this.storeInfo.userCollect?(0,s.collectDel)([this.storeInfo.product_id]).then((function(e){t.storeInfo.userCollect=!t.storeInfo.userCollect})):(0,s.collectAdd)(this.storeInfo.product_id).then((function(e){t.storeInfo.userCollect=!t.storeInfo.userCollect}))},open:function(t){this.showMenuIcon=t},listenerActionSheet:function(){this.currentPage=!1,0==this.isLogin?(0,n.toLogin)():this.posters=!0},listenerActionClose:function(){this.posters=!1},posterImageClose:function(){this.posterImageStatus=!1},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},downloadFilePromotionCode:function(e){var i=this;(0,r.scombinationCode)(i.id).then((function(o){t.downloadFile({url:i.setDomain(o.data.code),success:function(t){i.$set(i,"isDown",!1),"function"==typeof e?e&&e(t.tempFilePath):i.$set(i,"PromotionCode",t.tempFilePath)},fail:function(){i.$set(i,"isDown",!1),i.$set(i,"PromotionCode","")}})})).catch((function(t){i.$set(i,"isDown",!1),i.$set(i,"PromotionCode","")}))},goFriend:function(){this.posters=!1},savePosterPath:function(){var e=this;t.getSetting({success:function(i){i.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:this.$t("保存成功"),icon:"success"})},fail:function(t){e.$util.Tips({title:this.$t("保存失败")})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:this.$t("保存成功"),icon:"success"})},fail:function(t){e.$util.Tips({title:this.$t("保存失败")})}})}})}})},setShareInfoStatus:function(){var t=this,e=this.storeInfo,i=location.href;this.$wechat.isWeixin()&&(0,u.getUserInfo)().then((function(o){i=-1===i.indexOf("?")?i+"?spread="+o.data.uid:i+"&spread="+o.data.uid;var n={desc:e.store_info,title:e.store_name,link:i,imgUrl:e.image};t.$wechat.wechatEvevt(["updateAppMessageShareData","updateTimelineShareData"],n)}))},scroll:function(t){var e=this,i=t.detail.scrollTop,o=i/200;if(o=o>1?1:o,e.opacity=o,e.scrollY=i,e.$set(e,"showMenuIcon",!1),e.$set(e,"currentPage",!1),e.lock)e.lock=!1;else for(var n=0;n<e.topArr.length;n++)if(i<e.topArr[n]-d.globalData.navHeight/2+e.heightArr[n]){e.navActive=n;break}},tap:function(t,e){var i=t.id,o=(e=e,this);this.replyCount||"past1"!=i||(i="past2"),this.toView=i,this.navActive=e,this.lock=!0,this.scrollTop=e>0?o.topArr[e]-d.globalData.navHeight/2:o.topArr[e]},showImg:function(t){this.$refs.cusPreviewImg.open(this.selectSku.suk)},changeSwitch:function(t){var e=this.skuArr[t];this.$set(this,"selectSku",e);var i=e.suk.split(",");this.$set(this.attribute.productAttr[0],"index",i[0]),2==i.length?(this.$set(this.attribute.productAttr[0],"index",i[0]),this.$set(this.attribute.productAttr[1],"index",i[1])):3==i.length?(this.$set(this.attribute.productAttr[0],"index",i[0]),this.$set(this.attribute.productAttr[1],"index",i[1]),this.$set(this.attribute.productAttr[2],"index",i[2])):4==i.length&&(this.$set(this.attribute.productAttr[0],"index",i[0]),this.$set(this.attribute.productAttr[1],"index",i[1]),this.$set(this.attribute.productAttr[2],"index",i[2]),this.$set(this.attribute.productAttr[3],"index",i[3])),e&&(this.$set(this.attribute.productSelect,"image",e.image),this.$set(this.attribute.productSelect,"price",e.price),this.$set(this.attribute.productSelect,"stock",e.stock),this.$set(this.attribute.productSelect,"unique",e.unique),this.$set(this.attribute.productSelect,"vipPrice",e.vipPrice),this.$set(this,"attrTxt",this.$t("已选择")),this.$set(this,"attrValue",e.suk))}},onShareAppMessage:function(){return{title:this.storeInfo.title,path:d.globalData.openPages,imageUrl:this.storeInfo.image}}};e.default=k}).call(this,i("543d")["default"])},"5d22":function(t,e,i){},"701a":function(t,e,i){"use strict";(function(t){i("7b91");o(i("66fd"));var e=o(i("b9a3"));function o(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},9869:function(t,e,i){"use strict";var o=i("5d22"),n=i.n(o);n.a},b9a3:function(t,e,i){"use strict";i.r(e);var o=i("d867"),n=i("16b2");for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);i("9869");var s,u=i("f0c5"),a=Object(u["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=a.exports},d867:function(t,e,i){"use strict";var o;i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return o}));var n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.$t("￥")),o=t.attribute.productAttr.length&&(t.attribute.productAttr.length?t.attribute.productAttr[0].attr_values.length:0)>1?t.$t("起"):null,n=t.$t("￥"),r=t.$t("类型"),s=t.$t("人团"),u=t.$t("累计销量"),a=t.$t(t.storeInfo.unit_name)||"",c=t.$t("限购"),l=t.$t(t.storeInfo.unit_name)||"",h=t.attribute.productAttr.length&&t.skuArr.length>1?t.skuArr.slice(0,4):null,d=t.attribute.productAttr.length&&t.skuArr.length>1?t.$t("共"):null,p=t.attribute.productAttr.length&&t.skuArr.length>1?t.$t("种规格可选"):null,f=t.$t("已拼"),m=t.$t("件"),g=t.__map(t.pink,(function(e,i){var o=t.__get_orig(e),n=i<t.AllIndex?t.$t("还差"):null,r=i<t.AllIndex?t.$t("人成团"):null,s=i<t.AllIndex?t.$t("去拼单"):null;return{$orig:o,m13:n,m14:r,m15:s}})),$=t.pink.length&&t.pink.length>t.AllIndex?t.$t("查看更多"):null,b=!t.pink.length||t.pink.length>t.AllIndex||t.pink.length!==t.AllIndex||t.pink.length===t.AllIndexDefault?null:t.$t("收起"),v=t.$t("拼团玩法"),_=t.$t("开团/参团"),S=t.$t("邀请好友"),I=t.$t("满员发货"),A=t.replyCount?t.$t("用户评价"):null,k=t.replyCount?t.$t("好评率"):null,w=t.$t("产品介绍"),x=t.$t("首页"),C=t.$t("收藏"),P=t.$t("单独购买"),y=t.attribute.productSelect.product_stock>0&&t.attribute.productSelect.quota>0?t.$t("立即开团"):null,T=t.dataShow?null:t.$t("立即开团"),q=t.attribute.productSelect.quota<=0||t.attribute.productSelect.product_stock<=0?t.$t("已售罄"):null,D=t.$t("发送给朋友"),V=t.$t("生成海报"),L=t.posterImageStatus?t.$t("保存到手机"):null;t._isMounted||(t.e0=function(e){t.H5ShareBox=!1}),t.$mp.data=Object.assign({},{$root:{m0:i,m1:o,m2:n,m3:r,m4:s,m5:u,m6:a,m7:c,m8:l,l0:h,m9:d,m10:p,m11:f,m12:m,l1:g,m16:$,m17:b,m18:v,m19:_,m20:S,m21:I,m22:A,m23:k,m24:w,m25:x,m26:C,m27:P,m28:y,m29:T,m30:q,m31:D,m32:V,m33:L}})},r=[]}},[["701a","common/runtime","common/vendor"]]]);